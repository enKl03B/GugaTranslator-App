# 🐧 “企鹅语”编码/解码逻辑详解

本文档旨在解释“企鹅语”转换工具背的核心算法。从根本上说，“企鹅语”是一种自定义的 Base64 编码方案。

## 1. 核心概念

标准 Base64 编码使用一个包含 64 个 ASCII 字符的集合（`A-Z`, `a-z`, `0-9`, `+`, `/`）来表示任意二进制数据。

“企鹅语”遵循同样的基本原则，但它不直接使用这 64 个 ASCII 字符，而是将它们一一映射到一组由 5 个基础符号构成的、长度为 3 的独特组合上。

## 2. 基础符号集 (Alphabet)

“企鹅语”的所有编码都源于以下这 5 个基础符号：

```python
['咕', '嘎', '🐧', '🍄', '哇擦']
```

## 3. 编码表的生成

为了将标准的 64 个 Base64 字符（我们称其索引为 0-63）映射到新的符号组合，我们采用了一种类似“五进制”的转换思想。

对于 0 到 63 之间的每一个数字 `i`，我们通过以下步骤为其生成一个独一无二的、由三个基础符号组成的字符串：

1.  **计算第一位符号的索引 (`d2`)**:
    `d2 = i // 25`
2.  **计算第二位符号的索引 (`d1`)**:
    `n = i % 25`
    `d1 = n // 5`
3.  **计算第三位符号的索引 (`d0`)**:
    `d0 = n % 5`

4.  **组合符号**:
    使用计算出的三个索引 `d2`, `d1`, `d0` 从基础符号集中取出对应的符号，拼接成一个三字符的组合。
    例如，`组合 = 基础符号集[d2] + 基础符号集[d1] + 基础符号集[d0]`

通过对 0-63 的所有数字重复此过程，我们就得到了一个完整的 `ENCODING_TABLE`，它建立了从标准 Base64 字符索引到“企鹅语”符号组合的映射关系。

**示例**：
*   当 `i = 0` 时, `d2=0, d1=0, d0=0` -> `咕咕咕`
*   当 `i = 33` 时, `d2=1, d1=1, d0=3` -> `嘎嘎🍄`

## 4. 编码 (Encode) 过程

将普通文本转换为“企鹅语”的步骤如下：

1.  **转为字节流**: 将输入的字符串使用 `UTF-8` 编码转换为字节序列。
2.  **标准 Base64 编码**: 使用 Python 的 `base64.b64encode()` 函数对字节序列进行标准 Base64 编码。结果是一个由 `A-Z`, `a-z`, `0-9`, `+`, `/` 以及可能的填充符 `=` 组成的 ASCII 字符串。
3.  **查表替换**: 遍历上一步得到的 Base64 字符串：
    *   如果字符是 `=`，则直接忽略。
    *   对于其他每一个 Base64 字符，在标准64字符集 (`BASE64_CHARS`) 中找到它的索引。
    *   使用这个索引去 `ENCODING_TABLE` 中查找对应的“企鹅语”三字符组合。
4.  **拼接结果**: 将所有查找到的三字符组合按顺序拼接起来，形成最终的“企鹅语”字符串。

## 5. 解码 (Decode) 过程

将“企鹅语”翻译回普通文本的步骤如下：

1.  **分组**: 将输入的“企鹅语”字符串从左到右，按每 3 个字符为一组进行切分。
2.  **反向查表**: 遍历所有三字符组合：
    *   使用预先生成好的解码表 `DECODING_TABLE` (它是 `ENCODING_TABLE` 的反向映射)，查找每个组合对应的原始 Base64 字符索引 (0-63)。
    *   如果某个组合在解码表中不存在，说明输入包含无效内容，解码失败并抛出错误。
    *   根据索引从标准64字符集 (`BASE64_CHARS`) 中找到原始的 Base64 字符。
3.  **重构 Base64 字符串**: 将所有找到的 Base64 字符按顺序拼接起来。
4.  **处理填充**: Base64 编码的长度必须是 4 的倍数。因此，需要计算当前字符串长度并补上相应数量的 `=` 填充符。
5.  **标准 Base64 解码**: 使用 Python 的 `base64.b64decode()` 函数对补全后的 Base64 字符串进行解码，得到原始的 `UTF-8` 字节序列。
6.  **转回文本**: 将解码后的字节序列使用 `UTF-8` 解码，还原为用户可读的普通文本。

## 6. 错误处理

*   **编码**: 编码过程相对稳定，因为输入是任意文本。
*   **解码**:
    *   如果输入的“企鹅语”长度不是 3 的倍数，解码会失败。
    *   如果输入包含了无法识别的三字符组合（即不在 `DECODING_TABLE` 中的组合），解码会失败。
    *   如果在最终的 Base64 解码步骤中发生错误（例如，由于错误的填充或无效的 Base64 字符序列），解码会失败。

这些检查确保了只有格式正确的“企鹅语”才能被成功解码。 